= {subject}: PREPARED FOR - {customer}
:subject: Oracle Cartridge Installation Guide
:description: Oracle OpenShift 2 Cartridge Installation
:doctype: book
:confidentiality: Confidential
:customer:  FRIT
:listing-caption: Listing
:toc:
:toclevels: 6
:sectnums:
:chapter-label:
:icons: font
ifdef::backend-pdf[]
:pdf-page-size: A4
:title-page-background-image: image:../usr/doc/header.jpeg[pdfwidth=8.0in,align=center]
:pygments-style: tango
//:source-highlighter: pygments
:source-highlighter: coderay
endif::[]

== Synopsis

The purpose of this document is to present the guidance to install and configure an Oracle OpenShift Enterprise V2.2 cartridge. It is meant to be loaded into OpenShift from source code.

The cartridge currently supports the following features:

* Creating an Oracle Database tenant instance via a call to a remote script
* Setting environment variables to allow web servers to call newly created tenant in a database

== Installation

=== Setup OSE Environment

The setup of the OSE Environment can be accomplished as per your usual way of deploying broker and nodes. This could be via the OSE install script, or any other CM tools like Puppet and Ansible

=== Install sshpass Utility

To provide the needed requirement that the SSH call use username/password rather than public-key exchange; the sshpass command needs to be installed. This is because the ssh command does not support silent username/password authentication as this cartridge would require. The sshpass tool is not avaliable from the official Red Hat repos, but can instead be downloaded from the Fedora EPEL repos.

Please refer to the official EPEL documentation for instructions on how to enable the repos: https://fedoraproject.org/wiki/EPEL

```
sudo yum install -y wget
wget https://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
rpm -Uvh epel-release-6-8.noarch.rpm
yum install -y sshpass
```

=== Oracle Provisioning Script Requirments

This cartridge is in and of itself not responsible for configuring a remote tenant, instead that responsibility lies to a script that resides on a remote host that will be called by the install script when the gear is instantiated. Script is called via a remote sshpass call. The script accepts username, password, and SID. It will then return:

*SUCCESS/FAIL@@HOST@@PORT@@TENNANT_ID*

== Cartridge Installation

The cartridge can be installed as any other  OSE cartridge. However, you must ensure that the *sshpass* utility has been installed.

Extract the zipped source code of the Oracle cartridge under

`/usr/libexec/openshift/cartridges`

You will also need to set the correct SELinux Context on the cartridge so that it is consistent with the rest of the cartridges on each node. This file context is:

`system_u:object_r:bin_t:s0`

To set this context run the following command:

`chcon -R -u system_u /usr/libexec/openshift/cartridges/ose2-oracle-frb-cart-frb-was*/`

On each OpenShift node where you wish to make this cartridge available execute the following commands:

```
cd /usr/libexec/openshift/cartridges
oo-admin-cartridge --action install --recursive --source /usr/libexec/openshift/cartridges
```

To make the cartridge available run this command from the broker:

```
oo-admin-ctl-cartridge --activate -c import-node node.hostname
oo-admin-broker-cache --clear && oo-admin-console-cache --clear
```

<<<

You now need to set the environment variables on each Node. Please note that the script does expect the password variable value to be a base64 hash of the plaintext password. Modify as needed:

```
echo "oraclescripthost.example.com" > /etc/openshift/env/OPENSHIFT_ORACLE_DB_SCRIPT_HOST
echo "scriptuser" > /etc/openshift/env/OPENSHIFT_ORACLE_DB_SCRIPT_USER
echo "$(echo "Password123" |  base64)" > /etc/openshift/env/OPENSHIFT_ORACLE_DB_SCRIPT_ENC_PASSWORD
echo "/OracleProvisioningScript.sh" > /etc/openshift/env/OPENSHIFT_ORACLE_DB_SCRIPT_LOC
echo "@@" > /etc/openshift/env/OPENSHIFT_ORACLE_DB_SCRIPT_DELIMINATOR
```

[width="100%"]
|=========================================================================================================================================================================
| **OPENSHIFT_ORACLE_DB_SCRIPT_HOST** | This is the hostname that the remote Oracle configuration script resides on.
| **OPENSHIFT_ORACLE_DB_SCRIPT_USER** | This is the username that will be used to remotely call the configuration script via SSH on **OPENSHIFT_ORACLE_DB_SCRIPT_HOST**.
| **OPENSHIFT_ORACLE_DB_SCRIPT_ENC_PASSWORD** | This is the password for the **OPENSHIFT_ORACLE_DB_SCRIPT_USER**. It is expected that the password is in 64 bit hash.
| **OPENSHIFT_ORACLE_DB_SCRIPT_LOC** | This is the location on **OPENSHIFT_ORACLE_DB_SCRIPT_HOST** where the remote configuration script resides.
| **OPENSHIFT_ORACLE_DB_SCRIPT_DELIMINATOR** | This is the deliminator used in the return value coming from the remote configuration script. This should be set to '**@@**'
|==========================================================================================================================================================================


== Reference Information

*OpenShift V2*

* http://openshift.github.io/documentation/oo_cartridge_developers_guide.html[Cartridge Developers Guide]
* https://www.openshift.com/content/at-least-one-port-for-external-use-excluding-8080-please[How to expose more than one public port in cartridge]
